# Read email and password from file
# $email = Get-Content /c/Users/Mohamed Saber/Desktop/mail.txt | Select-Object -First 1
# $password = Get-Content "C:\Users\Mohamed Saber\Desktop\mail.txt" | Select-Object -# #Last 1
$email = Get-Content -Path "C:\Users\Mohamed Saber\Desktop\mail.txt" | Select-Object -First 1 
$password = Get-Content -Path "C:\Users\Mohamed Saber\Desktop\mail.txt" | Select-Object -Skip 1 | Select-Object -First 1
# Get current CPU utilization
$cpu_utilization = (Get-Counter "\Processor(_Total)\% Processor Time").CounterSamples.CookedValue

# Check if utilization is above threshold
if ($cpu_utilization -gt 50) {
    # Get current disk space
    $disk_space = Get-PSDrive -PSProvider FileSystem | Select-Object -Property Name, @{Name="FreeSpace(GB)"; Expression={[Math]::Round(($_.Free/1GB),2)}}

    # Construct alert message
    $message = "CPU utilization is above 50% ($cpu_utilization). Disk space is low:`n$disk_space"

    # Send email alert
    Send-MailMessage -From $email -To MyMail@gmail.com -Subject "CPU Utilization Alert" -Body $message -SmtpServer smtp.gmail.com -Credential (New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $email, (ConvertTo-SecureString -String $password -AsPlainText -Force)) -UseSsl
} 

